<?xml version="1.0" encoding="UTF-8"?>
<common_patterns>
  <overview>
    This file provides reusable patterns and templates for structuring different parts of the feature design document.
  </overview>

  <pattern name="Problem_Solution_Structure">
    <usage>For the '背景' (Background) section to clearly articulate the problem and proposed solution.</usage>
    <template><![CDATA[
### 1.2 需求与痛点 (Requirements and Pain Points)

- **Pain Point 1:** Describe a specific problem the user or system currently faces. (e.g., "The current process for X is manual and error-prone.")
- **Pain Point 2:** Describe another related issue. (e.g., "There is no visibility into the status of Y.")
- **Requirement:** State the high-level requirement to solve these pain points. (e.g., "We need an automated system to process X with real-time status tracking.")

### 1.3 使用场景 (Use Case)

- **Scenario:** A user wants to achieve [goal].
- **Steps:**
  1. The user performs [action 1].
  2. The system automatically does [process A].
  3. The user sees [result B].
    ]]></template>
  </pattern>

  <pattern name="API_Definition_Structure">
    <usage>For the 'API 设计' (API Design) section to define new endpoints or methods.</usage>
    <template><![CDATA[
#### POST /api/v1/feature

**Description:** Creates a new resource for the feature.

**Request Body:**
```json
{
  "name": "string",
  "value": "number"
}
```

**Response (200 OK):**
```json
{
  "id": "string",
  "status": "CREATED"
}
```
    ]]></template>
  </pattern>

  <pattern name="Data_Flow_Sequence">
    <usage>For the '详细设计' (Detailed Design) section to illustrate how data flows through the system.</usage>
    <template><![CDATA[
```mermaid
sequenceDiagram
    participant User
    participant ServiceA as Feature Service
    participant ServiceB as Data Service
    participant DB as Database

    User->>ServiceA: Submit new data
    activate ServiceA
    ServiceA->>ServiceB: Validate and enrich data
    activate ServiceB
    ServiceB-->>ServiceA: Return enriched data
    deactivate ServiceB
    ServiceA->>DB: Save data
    activate DB
    DB-->>ServiceA: Confirm save
    deactivate DB
    ServiceA-->>User: Acknowledge creation
    deactivate ServiceA
```
    ]]></template>
  </pattern>

  <pattern name="Directory_Structure">
    <usage>For the '概要设计' (High-Level Design) section to show the directory layout for new or modified files. Only include when the feature involves multiple new files or significant restructuring.</usage>
    <template><![CDATA[
### 2.3 目录结构 (Directory Structure)

```
src/main/java/com/example/
├── service/
│   └── NewService.java         # (NEW) Service description
├── repository/
│   └── NewRepository.java      # (NEW) Repository description
└── controller/
    └── ExistingController.java # (MODIFIED) What changes
```
    ]]></template>
  </pattern>

  <pattern name="Implementation_Changes">
    <usage>For the '实现变更' (Implementation Changes) section to show code changes with natural language descriptions. Organize by process/module, each file in a separate code block.</usage>
    <template><![CDATA[
### 5.1 [Process/Module Name]
> Brief summary of changes in this part.

```
// NEW: src/services/UserService.ts
class UserService {
    validateQuota(userId) {
        // Query user quota from quotaStore
        // Compare usage against limit, throw QuotaExceededError if exceeded
        // Return remaining quota for client display
    }
}
```

```
// MODIFIED: src/processors/OrderProcessor.ts
class OrderProcessor {
    submit(order) {
        // ...existing validation...
        // @after: validation
        // ~ queue.push(order) → queue.pushAsync(order)
        // + order.status = PENDING
        // + emit('order:submitted', order)
    }

    // - processSync(order) - entire method removed, replaced by async flow
}
```
    ]]></template>
  </pattern>

</common_patterns>
